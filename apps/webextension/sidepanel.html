<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Carvana Workflows Control Center</title>
    <style>
      :root { color-scheme: dark; }
      body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, sans-serif; background: #020617; color: #e2e8f0; }
      main { padding: 14px; display: grid; gap: 10px; }
      h1 { margin: 0; font-size: 15px; }
      h2 { margin: 0; font-size: 13px; color: #cbd5e1; }
      .meta { font-size: 12px; color: #94a3b8; }
      .tabs { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
      .tab-button { border: 1px solid #334155; background: #0f172a; color: #94a3b8; border-radius: 6px; padding: 8px; cursor: pointer; }
      .tab-button.active { color: #e2e8f0; background: #1e293b; }
      .panel { display: grid; gap: 10px; }
      .panel[hidden] { display: none; }
      .stack { display: grid; gap: 8px; }
      select, button, textarea { border: 1px solid #334155; background: #0f172a; color: #e2e8f0; border-radius: 6px; padding: 8px; }
      textarea { min-height: 100px; resize: vertical; font-family: ui-monospace, SFMono-Regular, Menlo, monospace; font-size: 12px; }
      button { cursor: pointer; }
      button:hover { background: #1e293b; }
      .row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
      pre { margin: 0; padding: 10px; border-radius: 8px; background: #0b1220; border: 1px solid #1e293b; overflow: auto; max-height: 30vh; font-size: 12px; }
      .logs-header { display: flex; justify-content: space-between; align-items: center; }
      .logs-list { display: grid; gap: 8px; max-height: 58vh; overflow: auto; }
      .log-card { border: 1px solid #1e293b; border-radius: 8px; background: #0b1220; padding: 8px; display: grid; gap: 6px; }
      .log-summary { font-size: 12px; color: #cbd5e1; display: flex; justify-content: space-between; gap: 8px; }
      .log-meta { font-size: 11px; color: #94a3b8; }
      .log-pre { max-height: 30vh; }
      .empty { font-size: 12px; color: #94a3b8; padding: 8px; border: 1px dashed #334155; border-radius: 8px; }
      .box { border: 1px solid #1e293b; border-radius: 8px; padding: 10px; background: #0b1220; display: grid; gap: 8px; }
      .small { font-size: 11px; color: #94a3b8; }
    </style>
  </head>
  <body>
    <main>
      <h1>Carvana Workflow Control Center</h1>
      <div id="site" class="meta">Site: detecting...</div>
      <div class="tabs">
        <button id="tab-workflows" class="tab-button active" type="button">Workflows</button>
        <button id="tab-logs" class="tab-button" type="button">Logs</button>
      </div>

      <section id="panel-workflows" class="panel">
        <div class="stack">
          <label for="workflow-select">Workflow</label>
          <select id="workflow-select"></select>
          <div class="row">
            <button id="run-workflow" type="button">Run Workflow</button>
            <button id="capture-table" type="button">Capture Jira Table</button>
          </div>
        </div>

        <section id="jira-builder" class="box" hidden>
          <h2>Jira JQL Builder</h2>
          <div class="small">Builder is extension-native. Apply query directly to active Jira tab.</div>
          <div class="row">
            <button id="jql-preset-my-active" type="button">My Active Work</button>
            <button id="jql-preset-my-open" type="button">My Open Issues</button>
          </div>
          <textarea id="jql-editor" placeholder="project = AP AND assignee = currentUser() AND statusCategory != Done ORDER BY updated DESC"></textarea>
          <div class="row">
            <button id="jql-apply" type="button">Apply JQL</button>
            <button id="jql-run" type="button">Apply + Run</button>
          </div>
          <div id="jql-status" class="small">Ready.</div>
        </section>

        <pre id="output">Ready.</pre>
      </section>

      <section id="panel-logs" class="panel" hidden>
        <div class="logs-header">
          <div class="meta">Run History</div>
          <button id="clear-logs" type="button">Clear Logs</button>
        </div>
        <div id="logs-empty" class="empty">No runs recorded yet.</div>
        <div id="logs-list" class="logs-list"></div>
      </section>
    </main>
    <script src="sidepanel.js"></script>
  </body>
</html>
