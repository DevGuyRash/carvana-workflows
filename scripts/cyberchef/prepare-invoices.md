Comment('C00 High level: clean lines, build HUB rows, compute totals, and output summary sections.')
Comment('C01 Trim leading and trailing whitespace from each line.')
Find_/_Replace({'option':'Regex','string':'^[ \\t]+|[ \\t]+$'},'',true,false,true,false)
Comment('C02 Remove any text before the first 10 digit number on a line.')
Find_/_Replace({'option':'Regex','string':'^.*?(?=\\d{10}|$)'},'',true,false,true,false)
Comment('C03 Collapse multiple blank lines down to a single newline.')
Find_/_Replace({'option':'Regex','string':'[\\r\\n]{2,}'},'\\n',true,false,true,false)
Comment('C04 Normalise spaces and tabs so there is a single tab between columns.')
Find_/_Replace({'option':'Regex','string':'\\t+|(?:\\s+\\t+|\\t+\\s+)+'},'\\t',true,false,true,false)
Comment('C05 Remove currency symbols and commas from numeric amounts.')
Find_/_Replace({'option':'Regex','string':'\\$ *|,'},'',true,false,true,false)
Comment('C06 Reshape each row into HUB prefix form with last one or two numeric amounts grouped.')
Find_/_Replace({'option':'Regex','string':'(\\d+?)\\s+(\\S+?)\\s+(\\d+?)\\s+(\\d+(?:\\.\\d*)?(?:\\s+\\d+(?:\\.\\d*)?)?)$'},'HUB-$1-$2-$3\\t|\\t$4',true,false,true,false)
Comment('C07 Ensure remaining multiple spaces or tabs between fields become a single tab.')
Find_/_Replace({'option':'Regex','string':'[ \\t]+'},'\\t',true,false,true,false)
Comment('C08 Subsection on the numeric part after the pipe so we can safely sum per row amounts.')
Subsection('(?<=\\|[ \\t])(\\d+(?:\\.\\d*)?(?:[ \\t]\\d+(?:\\.\\d*)?)?)',true,true,false)
Comment('C09 Inside subsection collapse any internal whitespace in the numeric part to single spaces.')
Find_/_Replace({'option':'Regex','string':'[ \\t]+'},' ',true,false,true,false)
Comment('C10 Sum the space separated numeric values inside each subsection to get a row total.')
Sum('Space')
Comment('C11 Merge the subsection back into full lines with the new row totals in place.')
Merge(true)
Comment('C12 Remove any trailing whitespace or newlines at the very end of the output.')
Find_/_Replace({'option':'Regex','string':'[\\n\\s]+$'},'',true,false,true,false)
Comment('C13 Add line numbers to the full HUB view and store it in register R0 as the master copy.')
Add_line_numbers()
Register('([\\s\\S]*)',true,true,false)
Comment('C14 From the HUB view extract each amount after the pipe on every row.')
Regular_expression('User defined','(?<=\\|\\s)([\\d,]+(?:\\.\\d+)?)\\s*$',true,true,false,false,false,false,'List capture groups')
Comment('C15 Add line numbers to the list of row amounts and save that list into register R1.')
Add_line_numbers()
Register('([\\s\\S]*)',true,false,false)
Comment('C16 Restore master HUB lines from R0 so we can extract other fields.')
Find_/_Replace({'option':'Regex','string':'([\\s\\S]*)'},'$R0',false,false,true,false)
Comment('C17 Extract the first field after HUB dash which is the first id column used as stock numbers.')
Regular_expression('User defined','(?<=HUB-)(.+?)(?=-)',true,true,false,false,false,false,'List capture groups')
Comment('C18 Add line numbers to this first id column and store it in register R2.')
Add_line_numbers()
Register('([\\s\\S]*)',true,false,false)
Comment('C19 Pad lines so each stock line has three fields and save as R3 for invoice numbers section.')
Pad_lines('End',3,'-TR')
Register('([\\s\\S]*)',true,false,false)
Comment('C20 Restore the master HUB view from R0 again before extracting VIN values.')
Find_/_Replace({'option':'Regex','string':'.*'},'$R0',false,true,true,true)
Comment('C21 Extract the second HUB field which is treated as the VIN value.')
Regular_expression('User defined','(?:HUB-.+?-)(.+?)(?=-)',true,true,false,false,false,false,'List capture groups')
Comment('C22 Add line numbers to the VIN list and store it in register R4.')
Add_line_numbers()
Register('([\\s\\S]*)',true,false,false)
Comment('C23 Restore the master HUB view from R0 again before extracting PID values.')
Find_/_Replace({'option':'Regex','string':'([\\s\\S]*)'},'$R0',false,true,true,false)
Comment('C24 Extract the third HUB field which is treated as the PID value.')
Regular_expression('User defined','(?:HUB-.+?-.+?-)(.+?)(?=\\s)',true,true,false,false,false,false,'List capture groups')
Comment('C25 Add line numbers to the PID list and save it into register R5.')
Add_line_numbers()
Register('([\\s\\S]*)',true,false,false)
Comment('C26 Restore the master HUB view from R0 again so totals can be processed.')
Find_/_Replace({'option':'Regex','string':'([\\s\\S]*)'},'$R0',false,false,true,false)
Comment('C27 Build a list of all row totals by matching the amount after the pipe on each line.')
Regular_expression('User defined','(?<=\\|[\\t ])([\\d,]+(?:\\.?\\d+)?) *$',true,true,false,true,false,true,'List matches')
Comment('C28 From the Total found line capture the count of totals and store it in register R6.')
Register('(?<=[Tt]otal found: )(([\\d,]+(?:\\.?\\d+)?))',true,false,false)
Comment('C29 Remove the Total found header block so we are left with only one amount per line.')
Find_/_Replace({'option':'Regex','string':'[Tt]otal found:[\\s\\S]+?\\n{2,}'},'',true,false,true,false)
Comment('C30 Sum all line separated amounts to get the grand total for all rows.')
Sum('Line feed')
Comment('C31 Prepend the original HUB lines from R0 and a GRAND TOTAL label before the summed value.')
Find_/_Replace({'option':'Regex','string':'^'},'$R0\\n\\n\\tGRAND TOTAL\\t',true,false,true,false)
Comment('C32 Store this combined view with HUB lines and grand total into register R7 as a snapshot.')
Register('([\\s\\S]*)',true,false,false)
Comment('C33 From the combined view extract HUB descriptors which will act as descriptions.')
Regular_expression('User defined','(HUB-.+?-.+?-.+?(?=\\s))',true,true,false,false,false,false,'List matches')
Comment('C34 Add line numbers to the HUB descriptions and save as register R8.')
Add_line_numbers()
Register('([\\s\\S]*)',true,false,false)
Comment('C35 Replace current output with the line numbered HUB descriptions from register R8.')
Find_/_Replace({'option':'Regex','string':'([\\s\\S]*)'},'$R8',false,false,true,false)
Comment('C36 Append a Total Count line using the count stored earlier in register R6.')
Find_/_Replace({'option':'Regex','string':'$'},'\\n\\tTotal Count:\\t$R6',false,false,false,false)
Comment('C37 Append all summary sections using the captured registers for each data type.')
Find_/_Replace({'option':'Regex','string':'$'},'\\n\\nPaid Amounts:\\n$R1\\n\\nDescriptions:\\n$R9\\n\\nStock Numbers:\\n$R2\\n\\nVIN Numbers:\\n$R4\\n\\nPID Numbers:\\n$R5\\n\\nInvoice Numbers:\\n$R3',false,false,false,false)
Comment('C38 Capture final combined output into register R9 for later reuse if needed.')
Register('([\\s\\S]*)',true,false,false)
Comment('C39 Optional disabled step to strip line numbers from the start of each line if enabled.')
Find_/_Replace({'option':'Regex','string':'^\\s*\\d+\\s*'},'',true,false,true,false/disabled)
