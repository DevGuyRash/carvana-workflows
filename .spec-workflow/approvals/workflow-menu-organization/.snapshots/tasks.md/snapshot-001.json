{
  "id": "snapshot_1761559906150_k7w2vy2gl",
  "approvalId": "approval_1761559906148_75i1uelzg",
  "approvalTitle": "workflow-menu-organization tasks",
  "version": 1,
  "timestamp": "2025-10-27T10:11:46.150Z",
  "trigger": "initial",
  "status": "pending",
  "content": "- [ ] 1. Implement workflow preferences persistence service\n  - File: packages/core/src/menu/workflow-preferences.ts\n  - Create a typed service to persist ordering and hidden-state metadata with versioning, reconciliation, and Store-backed serialization\n  - Export helper to surface ordered and hidden workflow lists for MenuUI consumers\n  - _Leverage: packages/core/src/storage.ts, packages/core/src/autorun.ts_\n  - _Requirements: Requirement 1, Requirement 2, Requirement 3_\n  - _Prompt: Implement the task for spec workflow-menu-organization, first run spec-workflow-guide to get the workflow guide then implement the task: Role: TypeScript Platform Engineer focused on state persistence | Task: Build workflow-preferences service providing ordered/hidden retrieval, mutation APIs, and fault-tolerant reconciliation against runtime workflow IDs | Restrictions: Keep serialization format versioned, avoid direct DOM coupling, reuse Store patterns from storage.ts | _Leverage: storage.ts, autorun.ts serialization helpers | _Requirements: Requirement 1, Requirement 2, Requirement 3 | Success: New service persists order/hidden state, gracefully handles missing/corrupt data, and exposes methods consumed by MenuUI_\n\n- [ ] 2. Add drag interaction controller utility\n  - File: packages/core/src/menu/drag-controller.ts\n  - Implement pointer and keyboard handlers to reorder list items via callbacks while respecting accessibility focus management\n  - Provide attach/detach lifecycle tied to MenuUI list elements\n  - _Leverage: packages/core/src/ui.ts (existing event patterns)_\n  - _Requirements: Requirement 1, Usability_\n  - _Prompt: Implement the task for spec workflow-menu-organization, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Frontend Interaction Engineer specializing in accessible drag-and-drop | Task: Create reusable drag-controller utility supporting pointer and keyboard reordering callbacks for workflow items | Restrictions: No global event leakage outside Shadow DOM, maintain 60fps-friendly updates, ensure keyboard shortcuts mirror drag semantics | _Leverage: ui.ts event patterns | _Requirements: Requirement 1, Usability | Success: Utility attaches to workflow list, emits stable reorder callbacks, and supports both pointer and keyboard interactions_\n\n- [ ] 3. Integrate preferences and drag controller into MenuUI workflows tab\n  - File: packages/core/src/ui.ts\n  - Use WorkflowPreferencesService and DragController to render ordered lists, reveal drag handles, handle reorder persistence, and debounce writes\n  - Show visual drop indicators and announce status updates\n  - _Leverage: packages/core/src/menu/workflow-preferences.ts, packages/core/src/menu/drag-controller.ts_\n  - _Requirements: Requirement 1, Non-Functional Performance_\n  - _Prompt: Implement the task for spec workflow-menu-organization, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Senior TypeScript UI Engineer maintaining MenuUI | Task: Wire new persistence service and drag controller into MenuUI to enable drag handles, reorder persistence, and live indicators | Restrictions: Preserve existing workflow footer behavior, debounce persistence within 250ms, avoid mutating workflow definitions directly | _Leverage: workflow-preferences.ts, drag-controller.ts | _Requirements: Requirement 1, Non-Functional Performance | Success: Workflows tab supports drag handles with smooth reordering, stored order persists across reloads, existing profile/autorun controls remain functional_\n\n- [ ] 4. Implement hide/unhide controls and Hidden tab experience\n  - File: packages/core/src/ui.ts\n  - Add hide toggles, animate removal, and introduce Hidden tab rendering with search/filter, counters, and unhide action handling\n  - Ensure auto-run toggles respect hidden status with prompting behavior\n  - _Leverage: packages/core/src/menu/workflow-preferences.ts, packages/core/src/autorun.ts_\n  - _Requirements: Requirement 2, Requirement 3, Usability_\n  - _Prompt: Implement the task for spec workflow-menu-organization, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Product UI Engineer focusing on menu ergonomics | Task: Extend MenuUI to provide hide/unhide controls, Hidden tab with search/filter, and auto-run prompts for hidden workflows | Restrictions: Maintain keyboard access for hide/unhide, reuse tab switching patterns, prevent hidden workflows from auto-run without confirmation | _Leverage: workflow-preferences.ts, autorun.ts | _Requirements: Requirement 2, Requirement 3, Usability | Success: Users can hide workflows, Hidden tab surfaces count/search, unhide restores ordering, and hidden-auto-run conflicts prompt users_\n\n- [ ] 5. Style updates for drag handles and hidden surfaces\n  - File: packages/core/src/ui.ts (css string)\n  - Introduce modern visual treatments for drag handles, drop indicators, hidden badges, and tab badges while meeting contrast guidelines\n  - Ensure animations for hide transitions remain performant\n  - _Leverage: existing css() in MenuUI_\n  - _Requirements: Requirement 1, Requirement 2, Requirement 3, Usability_\n  - _Prompt: Implement the task for spec workflow-menu-organization, first run spec-workflow-guide to get the workflow guide then implement the task: Role: UI Engineer with expertise in design systems | Task: Update MenuUI CSS to add drag handle affordances, hidden badges, and animations that feel modern and accessible | Restrictions: Keep CSS scoped to Shadow DOM, avoid heavy box-shadows that hurt performance, ensure focus states remain visible | _Leverage: MenuUI css() | _Requirements: Requirement 1, Requirement 2, Requirement 3, Usability | Success: Visual design clearly communicates drag, hide, and hidden states, animations run smoothly, all new elements meet WCAG AA_\n\n- [ ] 6. Add unit tests for preferences and hiding logic\n  - File: packages/core/test/workflow.preferences.test.ts\n  - Cover order reconciliation, hide toggles, persistence version fallback, and auto-run prompt interactions at service level\n  - _Leverage: packages/core/test/autorun.test.ts patterns_\n  - _Requirements: Requirement 1, Requirement 2, Requirement 3, Reliability_\n  - _Prompt: Implement the task for spec workflow-menu-organization, first run spec-workflow-guide to get the workflow guide then implement the task: Role: TypeScript Test Engineer focusing on core utilities | Task: Write unit tests validating workflow-preferences service ordering/hidden behavior and edge cases | Restrictions: Use Vitest patterns from existing core tests, mock Store interactions deterministically, avoid DOM reliance | _Leverage: autorun.test.ts patterns | _Requirements: Requirement 1, Requirement 2, Requirement 3, Reliability | Success: Tests cover reconciliation, hide/unhide, persistence errors, and pass reliably_\n\n- [ ] 7. Add integration tests for MenuUI interactions\n  - File: packages/core/test/ui.menu-organization.test.ts\n  - Simulate MenuUI drag reorder, hide/unhide flows, hidden tab rendering, and keyboard support using jsdom helpers\n  - _Leverage: packages/core/test/ui.theme.test.ts, packages/core/src/ui.ts_\n  - _Requirements: Requirement 1, Requirement 2, Requirement 3, Usability_\n  - _Prompt: Implement the task for spec workflow-menu-organization, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Frontend QA Automation Engineer for UI components | Task: Create integration tests exercising MenuUI drag, hide, and hidden tab interactions including accessibility affordances | Restrictions: Use existing MenuUI setup helpers, ensure tests run under Vitest/jsdom, keep animations mocked or disabled for determinism | _Leverage: ui.theme.test.ts, ui.ts | _Requirements: Requirement 1, Requirement 2, Requirement 3, Usability | Success: Integration tests demonstrate drag reorder, hide/unhide, hidden tab UX, and keyboard navigation all function as specified_\n",
  "fileStats": {
    "size": 7969,
    "lines": 54,
    "lastModified": "2025-10-27T10:11:33.700Z"
  },
  "comments": []
}