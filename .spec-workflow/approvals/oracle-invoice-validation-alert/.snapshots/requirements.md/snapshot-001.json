{
  "id": "snapshot_1761727007486_j1xomdjun",
  "approvalId": "approval_1761727007483_ln2bxcjpo",
  "approvalTitle": "Oracle invoice validation alert requirements",
  "version": 1,
  "timestamp": "2025-10-29T08:36:47.486Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Requirements Document\n\n## Introduction\n\nDeliver an auto-run Oracle workflow that spot-checks invoice validation status and immediately surfaces a vivid, unobtrusive alert so analysts never miss invoices that must be re-validated. The workflow should run hands-off on eligible invoice pages, confirm the status element, and display a status banner that conveys risk without blocking the core UI.\n\n## Alignment with Product Vision\n\nReinforces the automation suite’s promise of proactive guardrails that keep back-office operators in flow. By detecting risky invoices and flagging them in-context, the feature prevents missed follow-ups while respecting Oracle’s layout constraints and our commitment to calm, legible overlays.\n\n## Requirements\n\n### Requirement 1 — Reliable Invoice Status Detection\n\n**User Story:** As an Oracle AP specialist, I want the workflow to auto-run on invoice forms and capture the current validation status so that I immediately know whether the invoice is safe, needs attention, or has an unknown state.\n\n#### Acceptance Criteria\n\n1. WHEN the page contains “Invoice Header” AND either “Edit Invoice” OR “Create Invoice” within the visible DOM THEN the workflow SHALL auto-run and evaluate the invoice status region.\n2. WHEN the workflow searches within anchor elements under the invoice status tables THEN it SHALL classify the first match of the text tokens “Validated” or “Needs Re-Validated” case-insensitively.\n3. IF no qualifying status element is present after configurable retries up to 12s THEN the workflow SHALL classify the status as `unknown` and record diagnostics for operator review.\n4. WHEN a new invoice header loads (detected via auto-run context tokens combining tab, header, and document title) THEN the workflow SHALL re-run after prior execution completes.\n\n### Requirement 2 — High-Visibility Animated Alert Banner\n\n**User Story:** As an analyst reviewing invoices, I want a dramatic yet unobtrusive banner that conveys the validation state without obscuring Oracle controls so that I can keep working while staying informed.\n\n#### Acceptance Criteria\n\n1. WHEN the status is `validated` THEN the workflow SHALL render a compact, fixed-position banner within the userscript HUD that pulses from deep green (#0f7a1f) to the menu’s standard accent for 1.5 seconds before settling to solid green.\n2. WHEN the status is `needs-revalidated` THEN the banner SHALL animate from a warning yellow to a saturated red (#c1121f) over 3 seconds and remain visibly red until dismissed or the state changes.\n3. WHEN the status is `unknown` THEN the banner SHALL flash a “mystery” gradient (e.g., ultraviolet to black) for 2 seconds, emit a warning message, and transition to a darker red variant distinct from the standard failure red.\n4. The banner SHALL remain clickable only for dismissal, occupy no more than 15% of vertical viewport, and scale typography responsively between 18–24px for readability.\n\n### Requirement 3 — Operator Confirmation and Diagnostics Loop\n\n**User Story:** As a workflow maintainer, I want built-in confirmation and diagnostics so that selectors stay accurate and we can validate automated tests with human sign-off.\n\n#### Acceptance Criteria\n\n1. WHEN the workflow captures a status THEN it SHALL log the matched element text, DOM path summary, and banner color into workflow history for later export.\n2. WHEN selectors or tests are updated in development THEN the workflow SHALL expose a manual “Verify selectors” action that re-runs detection and reports whether the expected selector matched.\n3. IF the verification action fails or returns `unknown` status twice consecutively THEN the workflow SHALL prompt the user to confirm selector updates before enabling auto-run repeat.\n\n## Non-Functional Requirements\n\n### Code Architecture and Modularity\n- Encapsulate DOM querying and classification in a dedicated helper so tests and future workflows can reuse Oracle invoice status detection.\n- Keep visual banner rendering within the shared menu overlay, avoiding direct Oracle DOM mutations beyond necessary status reads.\n\n### Performance\n- Complete status detection and banner render within 500ms after the status element becomes available, excluding Oracle network delays.\n- Avoid re-rendering the banner more than once per auto-run cycle unless the status text changes.\n\n### Security\n- Do not persist invoice data beyond the derived status classification and diagnostic metadata needed for testing.\n- Ensure banner scripts respect existing CSP allowances and do not inject external assets.\n\n### Reliability\n- Retry status detection with exponential backoff up to 12 seconds to handle slow Oracle redraws, logging each attempt.\n- Guarantee banner teardown when navigating away from eligible invoice headers to prevent stale alerts.\n\n### Usability\n- Ensure banner colors and text meet WCAG 2.1 AA contrast ratios (≥ 4.5:1) against the menu background.\n- Provide screen-reader announcements via ARIA live region when the banner state changes.\n",
  "fileStats": {
    "size": 5054,
    "lines": 66,
    "lastModified": "2025-10-29T08:36:33.375Z"
  },
  "comments": []
}